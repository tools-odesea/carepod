<style>
  .cp-compare {
    background: {{ section.settings.bg_color }};
    padding: 5rem 2rem;
  }

  .cp-compare__inner {
    max-width: var(--page-width, 1200px);
    margin: 0 auto;
  }

  /* Header */
  .cp-compare__header {
    text-align: center;
    margin-bottom: 2.5rem;
  }

  .cp-compare__heading {
    font-size: clamp(1.5rem, 3vw, 2.25rem);
    font-family: var(--font-heading-family);
    font-style: var(--font-heading-style);
    font-weight: var(--font-heading-weight);
    color: #1a1a1a;
    margin: 0 0 0.75rem;
  }

  .cp-compare__subheading {
    font-size: 1rem;
    color: #666;
    line-height: 1.6;
    max-width: 580px;
    margin: 0 auto;
  }

  /* Product selector tabs */
  .cp-compare__tabs {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .cp-compare__tab {
    padding: 0.5rem 1.25rem;
    border-radius: 100px;
    border: 1.5px solid #d8d8d8;
    background: transparent;
    font-size: 0.875rem;
    font-weight: 500;
    color: #444;
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: inherit;
  }

  .cp-compare__tab.is-active {
    background: #1a1a1a;
    border-color: #1a1a1a;
    color: #ffffff;
  }

  .cp-compare__tab:hover:not(.is-active) {
    border-color: #999;
    color: #1a1a1a;
  }

  /* Table */
  .cp-compare__table-wrap {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .cp-compare__table {
    width: 100%;
    border-collapse: collapse;
    min-width: 480px;
  }

  /* Product header row */
  .cp-compare__product-headers th {
    padding: 1rem 0.75rem 1.5rem;
    text-align: center;
    vertical-align: bottom;
  }

  .cp-compare__product-headers th:first-child {
    text-align: left;
    width: 30%;
  }

  .cp-compare__product-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.625rem;
  }

  .cp-compare__product-img {
    width: 80px;
    height: 80px;
    object-fit: contain;
  }

  .cp-compare__product-name {
    font-size: 0.875rem;
    font-weight: 700;
    color: #1a1a1a;
    text-align: center;
    line-height: 1.25;
    display: block;
  }

  .cp-compare__product-desc {
    font-size: 0.75rem;
    color: #888;
    text-align: center;
    line-height: 1.4;
    max-width: 130px;
    display: block;
  }

  .cp-compare__buy-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: #1a1a1a;
    color: #fff;
    text-decoration: none;
    padding: 0.5rem 1.1rem;
    border-radius: 3px;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.01em;
    transition: background 0.2s ease;
    margin-top: 0.25rem;
  }

  .cp-compare__buy-btn:hover {
    background: #333;
  }

  /* Hidden by default — shown via JS when tab active */
  .cp-compare__product-th {
    transition: opacity 0.2s ease;
  }

  .cp-compare__product-th.is-hidden {
    display: none;
  }

  /* Spec rows */
  .cp-compare__table tbody tr {
    border-top: 1px solid #ebebeb;
  }

  .cp-compare__table tbody td {
    padding: 0.875rem 0.75rem;
    font-size: 0.875rem;
    color: #444;
    vertical-align: middle;
  }

  .cp-compare__table tbody td:first-child {
    font-weight: 600;
    color: #1a1a1a;
    text-align: left;
  }

  .cp-compare__table tbody td:not(:first-child) {
    text-align: center;
    color: #555;
  }

  .cp-compare__table tbody td.is-hidden {
    display: none;
  }

  /* Check / dash icons */
  .cp-compare__yes {
    color: #1a6cde;
    font-size: 1.1rem;
  }

  .cp-compare__no {
    color: #ccc;
    font-size: 1.1rem;
  }

  @media screen and (max-width: 749px) {
    .cp-compare {
      padding: 3.5rem 0.75rem;
    }

    .cp-compare__tabs {
      gap: 0.375rem;
    }

    .cp-compare__tab {
      padding: 0.4rem 0.9rem;
      font-size: 0.8125rem;
    }
  }
</style>

<div class="cp-compare" id="cp-compare-{{ section.id }}">
  <div class="cp-compare__inner">

    <div class="cp-compare__header">
      <h2 class="cp-compare__heading">{{ section.settings.heading | escape }}</h2>
      {%- if section.settings.subheading != blank -%}
        <p class="cp-compare__subheading">{{ section.settings.subheading | escape }}</p>
      {%- endif -%}
    </div>

    {%- assign product_blocks = section.blocks | where: 'type', 'product' -%}

    <!-- Tabs -->
    <div class="cp-compare__tabs" role="tablist">
      {%- for block in product_blocks -%}
        <button
          class="cp-compare__tab{% if forloop.first %} is-active{% endif %}"
          data-product-index="{{ forloop.index0 }}"
          role="tab"
          aria-selected="{{ forloop.first }}"
        >{{ block.settings.name | escape }}</button>
      {%- endfor -%}
    </div>

    <div class="cp-compare__table-wrap">
      <table class="cp-compare__table" role="table">
        <thead>
          <tr class="cp-compare__product-headers">
            <th scope="col"></th>
            {%- for block in product_blocks -%}
              <th
                scope="col"
                class="cp-compare__product-th{% unless forloop.first %} is-hidden{% endunless %}"
                data-product-index="{{ forloop.index0 }}"
                {{ block.shopify_attributes }}
              >
                <div class="cp-compare__product-col">
                  {%- if block.settings.image != blank -%}
                    {{
                      block.settings.image
                      | image_url: width: 200
                      | image_tag:
                        class: 'cp-compare__product-img',
                        widths: '80, 160, 200',
                        sizes: '80px',
                        loading: 'lazy',
                        alt: block.settings.name | escape
                    }}
                  {%- endif -%}
                  <span class="cp-compare__product-name">{{ block.settings.name | escape }}</span>
                  {%- if block.settings.description != blank -%}
                    <span class="cp-compare__product-desc">{{ block.settings.description | escape }}</span>
                  {%- endif -%}
                  {%- if block.settings.url != blank -%}
                    <a href="{{ block.settings.url }}" class="cp-compare__buy-btn">Buy Now</a>
                  {%- endif -%}
                </div>
              </th>
            {%- endfor -%}
          </tr>
        </thead>
        <tbody>
          {%- assign row_blocks = section.blocks | where: 'type', 'spec_row' -%}
          {%- for row in row_blocks -%}
            <tr {{ row.shopify_attributes }}>
              <td>{{ row.settings.label | escape }}</td>
              {%- for block in product_blocks -%}
                {%- assign col_index = forloop.index0 -%}
                {%- assign val_key = 'val_' | append: col_index -%}
                {%- assign val = row.settings[val_key] -%}
                <td
                  class="{% unless forloop.first %}is-hidden{% endunless %}"
                  data-product-index="{{ col_index }}"
                >
                  {%- if val == 'yes' -%}
                    <span class="cp-compare__yes" aria-label="Yes">
                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <circle cx="10" cy="10" r="10" fill="#1a6cde" fill-opacity="0.12"/>
                        <path d="M5.5 10.5L8.5 13.5L14.5 7.5" stroke="#1a6cde" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                  {%- elsif val == 'no' -%}
                    <span class="cp-compare__no" aria-label="No">—</span>
                  {%- else -%}
                    {{ val | escape }}
                  {%- endif -%}
                </td>
              {%- endfor -%}
            </tr>
          {%- endfor -%}
        </tbody>
      </table>
    </div>

  </div>
</div>

<script>
  (function () {
    var section = document.getElementById('cp-compare-{{ section.id }}');
    if (!section) return;
    var tabs = section.querySelectorAll('.cp-compare__tab');
    var productThs = section.querySelectorAll('.cp-compare__product-th');
    var dataCells = section.querySelectorAll('tbody td[data-product-index]');

    tabs.forEach(function (tab) {
      tab.addEventListener('click', function () {
        var idx = parseInt(this.dataset.productIndex, 10);

        // Update tabs
        tabs.forEach(function (t) {
          t.classList.toggle('is-active', t === tab);
          t.setAttribute('aria-selected', t === tab);
        });

        // Show/hide product columns
        productThs.forEach(function (th) {
          th.classList.toggle('is-hidden', parseInt(th.dataset.productIndex, 10) !== idx);
        });

        dataCells.forEach(function (td) {
          td.classList.toggle('is-hidden', parseInt(td.dataset.productIndex, 10) !== idx);
        });
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Product Comparison",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "A Carepod for every room"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "The Carepod humidifier is versatile and user-friendly, making it ideal for any lifestyle, health need, or living space."
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product column",
      "limit": 4,
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Product name",
          "default": "Carepod One"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Short description",
          "default": "Ideal for the bedroom, home office, or studio apartment."
        },
        {
          "type": "url",
          "id": "url",
          "label": "Product link"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Product image"
        }
      ]
    },
    {
      "type": "spec_row",
      "name": "Spec row",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Spec label",
          "default": "Coverage"
        },
        {
          "type": "text",
          "id": "val_0",
          "label": "Product 1 value",
          "info": "Use 'yes' or 'no' to show icons, or type any value.",
          "default": "700 ft²"
        },
        {
          "type": "text",
          "id": "val_1",
          "label": "Product 2 value",
          "default": "500 ft²"
        },
        {
          "type": "text",
          "id": "val_2",
          "label": "Product 3 value",
          "default": "500 ft²"
        },
        {
          "type": "text",
          "id": "val_3",
          "label": "Product 4 value",
          "default": "350 ft²"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Comparison",
      "blocks": [
        {
          "type": "product",
          "settings": {
            "name": "Carepod Cube Plus",
            "description": "Ultimate coverage and upgraded features for pure, fresh air."
          }
        },
        {
          "type": "product",
          "settings": {
            "name": "Carepod One Plus",
            "description": "Ideal for living spaces, bedrooms, or studio apartments."
          }
        },
        {
          "type": "product",
          "settings": {
            "name": "Carepod One",
            "description": "Ideal for the bedroom, home office, or studio apartment."
          }
        },
        {
          "type": "product",
          "settings": {
            "name": "Carepod Mini",
            "description": "Perfect for nurseries and smaller spaces. A favorite for parents."
          }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Coverage", "val_0": "700 ft²", "val_1": "500 ft²", "val_2": "500 ft²", "val_3": "350 ft²" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Running time (Low)", "val_0": "32 hrs", "val_1": "30 hrs", "val_2": "30 hrs", "val_3": "20 hrs" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Running time (High)", "val_0": "12 hrs", "val_1": "10 hrs", "val_2": "10 hrs", "val_3": "10 hrs" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Mist output", "val_0": "Cool 350cc + Warm 440cc/hr", "val_1": "330cc/hr", "val_2": "330cc/hr", "val_3": "250cc/hr" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Mist type", "val_0": "Cool + Warm mist", "val_1": "Cool mist", "val_2": "Cool mist", "val_3": "Cool mist" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Tank capacity", "val_0": "4.2 L", "val_1": "4.0 L", "val_2": "4.0 L", "val_3": "2.8 L" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Dimensions (in)", "val_0": "9.9 × 9.8 × 11.8", "val_1": "10.8 × 10.2 × 9.3", "val_2": "10.8 × 10.2 × 9.3", "val_3": "4.5 × 11.4 × 9.3" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Night mode", "val_0": "yes", "val_1": "yes", "val_2": "no", "val_3": "no" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Mood light", "val_0": "yes", "val_1": "yes", "val_2": "no", "val_3": "no" }
        },
        {
          "type": "spec_row",
          "settings": { "label": "Warm mist sanitization", "val_0": "yes", "val_1": "no", "val_2": "no", "val_3": "no" }
        }
      ]
    }
  ]
}
{% endschema %}
